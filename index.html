<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA / Web App Einstellungen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-title" content="Haywire Finder">
    <meta name="application-name" content="Haywire Finder">
    
    <!-- iOS Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiB2aWV3Qm94PSIwIDAgMTkyIDE5MiI+PHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIGZpbGw9IiMwZjE3MmEiLz48Y2lyY2xlIGN4PSI5NiIgY3k9Ijk2IiByPSI0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjgiLz48L3N2Zz4=">

    <!-- Web Manifest (URL-Encoded für bessere Kompatibilität) -->
    <link rel="manifest" href="data:application/manifest+json;charset=utf-8,%7B%22name%22%3A%22Haywire%20Finder%22%2C%22short_name%22%3A%22Haywire%22%2C%22description%22%3A%22Moving%20Head%20Finder%20MJ%20Musical%22%2C%22id%22%3A%22haywire-finder-1.0%22%2C%22start_url%22%3A%22.%2Findex.html%22%2C%22display%22%3A%22standalone%22%2C%22display_override%22%3A%5B%22fullscreen%22%2C%22standalone%22%5D%2C%22orientation%22%3A%22portrait%22%2C%22background_color%22%3A%22%230f172a%22%2C%22theme_color%22%3A%22%230f172a%22%2C%22scope%22%3A%22.%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiB2aWV3Qm94PSIwIDAgMTkyIDE5MiI%2BPHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIGZpbGw9IiMwZjE3MmEiLz48Y2lyY2xlIGN4PSI5NiIgY3k9Ijk2IiByPSI0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjgiLz48L3N2Zz4%3D%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%2C%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgMTkyIDE5MiI%2BPHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIGZpbGw9IiMwZjE3MmEiLz48Y2lyY2xlIGN4PSI5NiIgY3k9Ijk2IiByPSI0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjgiLz48L3N2Zz4%3D%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%5D%7D">

    <title>Haywire Finder</title>
    
    <!-- Design & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Google Fonts: Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        html, body {
            background-color: #0f172a; 
            font-family: 'Roboto', sans-serif; 
            overscroll-behavior-y: none;
            height: 100%;
            overflow-x: hidden;
        }
        
        .font-brand {
            font-family: 'Roboto', sans-serif;
            letter-spacing: normal;
        }

        .grid-transition {
            transition: all 0.3s ease-in-out;
        }

        .fluid-header {
            font-size: clamp(0.95rem, 3.8vw, 1.6rem);
            line-height: 1.1;
        }

        .fluid-subtitle {
            font-size: clamp(0.55rem, 1.4vw, 0.65rem);
            line-height: 1.2;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icons = {
            Search: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            ),
            X: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            ),
            ArrowLeft: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
            ),
            Info: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            ),
            Layout: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
            ),
            MapPin: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
            )
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const IconComponent = Icons[name];
            return IconComponent ? <IconComponent width={size} height={size} className={className} /> : null;
        };

        // --- KOMPLETTE DATEN AUS CSV (Erweiterter Demo-Modus) ---
        const MOCK_DATA = [
            // Z-Brücke
            { id: 1, CHANNEL: "1", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/337", ROW: "7" },
            { id: 2, CHANNEL: "2", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/297", ROW: "6" },
            { id: 3, CHANNEL: "3", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/257", ROW: "5" },
            { id: 4, CHANNEL: "4", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/217", ROW: "4" },
            { id: 5, CHANNEL: "5", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/177", ROW: "3" },
            { id: 6, CHANNEL: "6", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/137", ROW: "2" },
            { id: 7, CHANNEL: "7", TYP: "Viper Performance", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 3", ADRESSE: "10/97", ROW: "1" },
            
            // Sound Truss
            { id: 11, CHANNEL: "11", TYP: "Viper Performance", POSITION: "Sound Truss SR", ORT: "Dimmerraum 4", ADRESSE: "15/201", ROW: "6" },
            { id: 12, CHANNEL: "12", TYP: "Viper Performance", POSITION: "Sound Truss SR", ORT: "Dimmerraum 4", ADRESSE: "15/121", ROW: "5" },
            { id: 13, CHANNEL: "13", TYP: "Viper Performance", POSITION: "Sound Truss SRC", ORT: "Dimmerraum 4", ADRESSE: "15/161", ROW: "4" },
            { id: 14, CHANNEL: "14", TYP: "Viper Performance", POSITION: "Sound Truss SLC", ORT: "Dimmerraum 4", ADRESSE: "15/81", ROW: "3" },
            { id: 15, CHANNEL: "15", TYP: "Viper Performance", POSITION: "Sound Truss SL", ORT: "Dimmerraum 4", ADRESSE: "15/41", ROW: "2" },
            { id: 16, CHANNEL: "16", TYP: "Viper Performance", POSITION: "Sound Truss SL", ORT: "Dimmerraum 4", ADRESSE: "15/1", ROW: "1" },

            // Prosc Boom & Near Box
            { id: 21, CHANNEL: "21", TYP: "Viper Performance", POSITION: "Prosc Boom SR", ORT: "Dimmerraum 4", ADRESSE: "15/281", ROW: "1" },
            { id: 22, CHANNEL: "22", TYP: "Viper Performance", POSITION: "Prosc Boom SL", ORT: "Dimmerraum 4", ADRESSE: "15/321", ROW: "1" },
            { id: 31, CHANNEL: "31", TYP: "Viper Performance", POSITION: "Near Box Boom SR", ORT: "Dimmerraum 4", ADRESSE: "15/361", ROW: "1" },
            { id: 32, CHANNEL: "32", TYP: "Viper Performance", POSITION: "Near Box Boom SL", ORT: "Dimmerraum 4", ADRESSE: "15/401", ROW: "1" },

            // Advanced Truss
            { id: 41, CHANNEL: "41", TYP: "Viper Performance", POSITION: "Advanced Truss SR", ORT: "Dimmerraum 4", ADRESSE: "16/1", ROW: "1" },
            { id: 42, CHANNEL: "42", TYP: "Viper Performance", POSITION: "Advanced Truss SL", ORT: "Dimmerraum 4", ADRESSE: "16/41", ROW: "1" },

            // DS Trough
            { id: 51, CHANNEL: "51", TYP: "Viper Performance", POSITION: "DS Trough", ORT: "Dimmerraum 1", ADRESSE: "10/1", ROW: "1" },
            { id: 52, CHANNEL: "52", TYP: "Viper Performance", POSITION: "DS Trough", ORT: "Dimmerraum 1", ADRESSE: "10/41", ROW: "1" },

            // LX 1
            { id: 101, CHANNEL: "101", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1/1", ROW: "1" },
            { id: 102, CHANNEL: "102", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1/41", ROW: "1" },
            { id: 103, CHANNEL: "103", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1/81", ROW: "1" },
            { id: 104, CHANNEL: "104", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1/121", ROW: "1" },
            { id: 105, CHANNEL: "105", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1/161", ROW: "1" },

            // LX 2
            { id: 111, CHANNEL: "111", TYP: "Viper Performance", POSITION: "LX 2", ORT: "Dimmerraum 2", ADRESSE: "2/1", ROW: "1" },
            { id: 112, CHANNEL: "112", TYP: "Viper Performance", POSITION: "LX 2", ORT: "Dimmerraum 2", ADRESSE: "2/41", ROW: "1" },
            { id: 113, CHANNEL: "113", TYP: "Viper Performance", POSITION: "LX 2", ORT: "Dimmerraum 2", ADRESSE: "2/81", ROW: "1" },

            // LX 3
            { id: 121, CHANNEL: "121", TYP: "Viper Performance", POSITION: "LX 3", ORT: "Dimmerraum 3", ADRESSE: "3/1", ROW: "1" },
            { id: 122, CHANNEL: "122", TYP: "Viper Performance", POSITION: "LX 3", ORT: "Dimmerraum 3", ADRESSE: "3/41", ROW: "1" },
            { id: 123, CHANNEL: "123", TYP: "Viper Performance", POSITION: "LX 3", ORT: "Dimmerraum 3", ADRESSE: "3/81", ROW: "1" },

            // LX 4
            { id: 131, CHANNEL: "131", TYP: "Viper Performance", POSITION: "LX 4", ORT: "Dimmerraum 2", ADRESSE: "4/1", ROW: "1" },
            { id: 132, CHANNEL: "132", TYP: "Viper Performance", POSITION: "LX 4", ORT: "Dimmerraum 2", ADRESSE: "4/41", ROW: "1" },
            { id: 133, CHANNEL: "133", TYP: "Viper Performance", POSITION: "LX 4", ORT: "Dimmerraum 2", ADRESSE: "4/81", ROW: "1" },

            // LX 5
            { id: 141, CHANNEL: "141", TYP: "Viper Performance", POSITION: "LX 5", ORT: "Dimmerraum 3", ADRESSE: "5/1", ROW: "1" },
            { id: 142, CHANNEL: "142", TYP: "Viper Performance", POSITION: "LX 5", ORT: "Dimmerraum 3", ADRESSE: "5/41", ROW: "1" },
            { id: 143, CHANNEL: "143", TYP: "Viper Performance", POSITION: "LX 5", ORT: "Dimmerraum 3", ADRESSE: "5/81", ROW: "1" },

            // Leitern (Viper)
            { id: 227, CHANNEL: "227", TYP: "Viper Performance", POSITION: "Leiter 2 SL", ORT: "Dimmerraum 2", ADRESSE: "11/201", ROW: "1" },
            { id: 228, CHANNEL: "228", TYP: "Viper Performance", POSITION: "Leiter 3 SL", ORT: "Dimmerraum 2", ADRESSE: "12/251", ROW: "1" },
            { id: 229, CHANNEL: "229", TYP: "Viper Performance", POSITION: "Leiter 4 SL", ORT: "Dimmerraum 2", ADRESSE: "12/371", ROW: "1" },

            // Leitern (Impression X5)
            { id: 251, CHANNEL: "251", TYP: "Impression X5", POSITION: "Leiter 1 SR", ORT: "Dimmerraum 1", ADRESSE: "13/241", ROW: "3" },
            { id: 252, CHANNEL: "252", TYP: "Impression X5", POSITION: "Leiter 2 SR", ORT: "Dimmerraum 1", ADRESSE: "13/276", ROW: "3" },
            { id: 253, CHANNEL: "253", TYP: "Impression X5", POSITION: "Leiter 3 SR", ORT: "Dimmerraum 1", ADRESSE: "14/335", ROW: "3" },
            { id: 254, CHANNEL: "254", TYP: "Impression X5", POSITION: "Leiter 4 SR", ORT: "Dimmerraum 1", ADRESSE: "14/370", ROW: "3" },
            { id: 256, CHANNEL: "256", TYP: "Impression X5", POSITION: "Leiter 1 SL", ORT: "Dimmerraum 2", ADRESSE: "11/241", ROW: "3" },
            { id: 257, CHANNEL: "257", TYP: "Impression X5", POSITION: "Leiter 2 SL", ORT: "Dimmerraum 2", ADRESSE: "11/276", ROW: "3" },
            { id: 258, CHANNEL: "258", TYP: "Impression X5", POSITION: "Leiter 3 SL", ORT: "Dimmerraum 2", ADRESSE: "12/411", ROW: "3" },
            { id: 259, CHANNEL: "259", TYP: "Impression X5", POSITION: "Leiter 4 SL", ORT: "Dimmerraum 2", ADRESSE: "12/446", ROW: "3" },

            // Booms
            { id: 261, CHANNEL: "261", TYP: "Impression X5", POSITION: "Boom 1 SR", ORT: "Dimmerraum 1", ADRESSE: "16/145", ROW: "2" },
            { id: 262, CHANNEL: "262", TYP: "Impression X5", POSITION: "Boom 2 SR", ORT: "Dimmerraum 1", ADRESSE: "16/180", ROW: "2" },
            { id: 263, CHANNEL: "263", TYP: "Impression X5", POSITION: "Boom 3 SR", ORT: "Dimmerraum 1", ADRESSE: "16/215", ROW: "2" },
            { id: 264, CHANNEL: "264", TYP: "Impression X5", POSITION: "Boom 4 SR", ORT: "Dimmerraum 1", ADRESSE: "16/250", ROW: "2" },
            { id: 265, CHANNEL: "265", TYP: "Impression X5", POSITION: "Boom 1 SL", ORT: "Dimmerraum 2", ADRESSE: "16/285", ROW: "2" },
            { id: 266, CHANNEL: "266", TYP: "Impression X5", POSITION: "Boom 2 SL", ORT: "Dimmerraum 2", ADRESSE: "16/320", ROW: "2" },
            { id: 267, CHANNEL: "267", TYP: "Impression X5", POSITION: "Boom 3 SL", ORT: "Dimmerraum 2", ADRESSE: "16/355", ROW: "2" },
            { id: 268, CHANNEL: "268", TYP: "Impression X5", POSITION: "Boom 4 SL", ORT: "Dimmerraum 2", ADRESSE: "16/390", ROW: "2" }
        ];

        function App() {
            const [fixtures, setFixtures] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [activeFilter, setActiveFilter] = useState("Alle");
            // Neuer State für den Reihen-Filter
            const [activeRowFilter, setActiveRowFilter] = useState(null);
            const [status, setStatus] = useState("Lade...");
            const [showAllForced, setShowAllForced] = useState(false);

            const filterRows = [
                // Reihe 1: Stone
                [{l:"Z-B 1",v:"Z-Brücke 1",c:"text-stone-500"}, {l:"1FS B",v:"Z-Brücke 3",c:"text-stone-500"}, {l:"Stage",v:"DS Trough",c:"text-stone-500"}, {l:"Portal",v:"Portal",c:"text-stone-500"}],
                // Reihe 2: Rose
                [{l:"ST SR",v:"Sound Truss SR",c:"text-rose-500"}, {l:"ST SRC",v:"Sound Truss SRC",c:"text-rose-500"}, {l:"ST SLC",v:"Sound Truss SLC",c:"text-rose-500"}, {l:"ST SL",v:"Sound Truss SL",c:"text-rose-500"}],
                // Reihe 3: Fuchsia
                [{l:"NBB SR",v:"Near Box Boom SR",c:"text-fuchsia-500"}, {l:"PB SR",v:"Prosc Boom SR",c:"text-fuchsia-500"}, {l:"AT SR",v:"Advanced Truss SR",c:"text-fuchsia-500"}],
                // Reihe 4: Violet
                [{l:"NBB SL",v:"Near Box Boom SL",c:"text-violet-500"}, {l:"PB SL",v:"Prosc Boom SL",c:"text-violet-500"}, {l:"AT SL",v:"Advanced Truss SL",c:"text-violet-500"}],
                // Reihe 5: Yellow
                [{l:"LX 1",v:"LX 1",c:"text-yellow-600"}, {l:"LX 2",v:"LX 2",c:"text-yellow-600"}, {l:"LX 3",v:"LX 3",c:"text-yellow-600"}, {l:"LX 4",v:"LX 4",c:"text-yellow-600"}, {l:"LX 5",v:"LX 5",c:"text-yellow-600"}],
                // Reihe 6: Teal
                [{l:"L1 SR",v:"Leiter 1 SR",c:"text-teal-500"}, {l:"L2 SR",v:"Leiter 2 SR",c:"text-teal-500"}, {l:"L3 SR",v:"Leiter 3 SR",c:"text-teal-500"}, {l:"L4 SR",v:"Leiter 4 SR",c:"text-teal-500"}],
                // Reihe 7: Orange
                [{l:"B1 SR",v:"Boom 1 SR",c:"text-cyan-500"}, {l:"B2 SR",v:"Boom 2 SR",c:"text-cyan-500"}, {l:"B3 SR",v:"Boom 3 SR",c:"text-cyan-500"}, {l:"B4 SR",v:"Boom 4 SR",c:"text-cyan-500"}],
                // Reihe 8: Teal
                [{l:"L1 SL",v:"Leiter 1 SL",c:"text-teal-500"}, {l:"L2 SL",v:"Leiter 2 SL",c:"text-teal-500"}, {l:"L3 SL",v:"Leiter 3 SL",c:"text-teal-500"}, {l:"L4 SL",v:"Leiter 4 SL",c:"text-teal-500"}],
                // Reihe 9: Cyan
                [{l:"B1 SL",v:"Boom 1 SL",c:"text-cyan-500"}, {l:"B2 SL",v:"Boom 2 SL",c:"text-cyan-500"}, {l:"B3 SL",v:"Boom 3 SL",c:"text-cyan-500"}, {l:"B4 SL",v:"Boom 4 SL",c:"text-cyan-500"}]
            ];

            const hardcodedValues = useMemo(() => filterRows.flat().map(item => item.v), []);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        const response = await fetch("fixtures.csv").catch(() => null);
                        if (response && response.ok) {
                            const csvText = await response.text();
                            window.Papa.parse(csvText, {
                                header: true,
                                skipEmptyLines: true,
                                complete: (results) => {
                                    if (results.data && results.data.length > 0) {
                                        const parsed = results.data.map((row, i) => ({
                                            id: Date.now() + i,
                                            CHANNEL: row.CHANNEL || row.Channel || "---",
                                            TYP: row.TYP || row.Typ || "Unbekannt",
                                            POSITION: row.POSITION || row.Position || "Unbekannt",
                                            ORT: row.ORT || row.Ort || "",
                                            ADRESSE: row.ADRESSE || row.Adresse || "---",
                                            ROW: row.ROW || row.Row || ""
                                        }));
                                        setFixtures(parsed);
                                        setStatus("");
                                    } else {
                                        setFixtures(MOCK_DATA);
                                        setStatus("Demo-Modus");
                                    }
                                }
                            });
                        } else {
                            setStatus("Bitte fixtures.csv bereitstellen");
                        }
                    } catch (e) {
                        setStatus("Fehler beim Laden");
                    }
                };
                loadData();
            }, []);

            const isInteractionActive = useMemo(() => searchTerm.trim() !== "" || activeFilter !== "Alle" || showAllForced, [searchTerm, activeFilter, showAllForced]);

            // Berechne die verfügbaren Reihen für den aktiven Filter
            const availableRows = useMemo(() => {
                if (activeFilter === "Alle") return [];
                
                const rows = new Set();
                fixtures.forEach(f => {
                    if (f.POSITION === activeFilter && f.ROW) {
                        // Versuche Zahl zu parsen, um sicherzustellen, dass wir sauber sortieren können
                        const r = parseInt(f.ROW, 10);
                        if (!isNaN(r)) {
                            rows.add(r);
                        }
                    }
                });
                
                return Array.from(rows).sort((a, b) => a - b);
            }, [fixtures, activeFilter]);

            const filteredFixtures = useMemo(() => {
                if (!isInteractionActive) return [];
                const search = searchTerm.trim().toLowerCase();
                const isNumericSearch = search !== "" && /^\d+$/.test(search);
                return fixtures.filter(f => {
                    const fixtureChannel = f.CHANNEL.toString().toLowerCase().trim();
                    const fixtureType = f.TYP.toLowerCase();
                    let matchesSearch = isNumericSearch ? fixtureChannel === search : (fixtureChannel.includes(search) || fixtureType.includes(search));
                    const matchesFilter = activeFilter === "Alle" || f.POSITION === activeFilter;
                    
                    // Reihen-Filter Logik
                    let matchesRow = true;
                    if (activeFilter !== "Alle" && activeRowFilter !== null) {
                        matchesRow = f.ROW === activeRowFilter.toString();
                    }

                    return matchesSearch && matchesFilter && matchesRow;
                });
            }, [fixtures, searchTerm, activeFilter, activeRowFilter, isInteractionActive]);

            const otherPositions = useMemo(() => {
                const hardcodedValues = filterRows.flat().map(item => item.v);
                const allPos = new Set(fixtures.map(f => f.POSITION));
                return Array.from(allPos).filter(p => p && p !== "Unbekannt" && !hardcodedValues.includes(p)).sort();
            }, [fixtures, filterRows]);

            const toggleFilter = (val) => {
                if (activeFilter === val) { 
                    setActiveFilter("Alle"); 
                    setShowAllForced(false); 
                } else { 
                    setActiveFilter(val); 
                    setShowAllForced(false); 
                }
                setActiveRowFilter(null);
            };

            const toggleRowFilter = (rowNum) => {
                setActiveRowFilter(activeRowFilter === rowNum ? null : rowNum);
            };

            const handleToggleAll = () => {
                if (showAllForced && activeFilter === "Alle" && searchTerm === "") setShowAllForced(false);
                else { setSearchTerm(""); setActiveFilter("Alle"); setShowAllForced(true); setActiveRowFilter(null); }
            };

            const activeFilterData = useMemo(() => {
                if (activeFilter === "Alle") return null;
                const found = filterRows.flat().find(it => it.v === activeFilter);
                if (found) return found;
                return { l: activeFilter, v: activeFilter, c: "text-slate-400" };
            }, [activeFilter, filterRows]);

            const FilterBtn = ({ label, value, colorClass = "text-slate-400" }) => (
                <button onClick={() => toggleFilter(value)} className={`min-w-[60px] px-2 py-1 rounded-lg text-xs font-normal transition-all border font-brand whitespace-nowrap flex items-center justify-center ${activeFilter === value ? 'bg-blue-600 border-blue-500 text-white shadow-lg scale-105' : `bg-slate-800 border-slate-700 ${colorClass} hover:bg-slate-700 hover:border-slate-500 hover:text-white`}`}>{label}</button>
            );

            return (
                <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-950 text-slate-200 font-brand pb-40">
                    <div className="sticky top-0 z-20 bg-slate-900/95 border-b border-slate-800 shadow-xl backdrop-blur-md px-4 py-4 md:py-6">
                        <div className="max-w-7xl mx-auto space-y-4">
                            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <div className="flex flex-col">
                                    <h1 className="fluid-header font-normal text-[#b3b3b3] font-brand truncate uppercase tracking-tight">HAYWIRE &nbsp; MOVING &nbsp; HEAD &nbsp; FINDER</h1>
                                    <div className="fluid-subtitle font-normal text-[#b3b3b3] font-brand uppercase tracking-widest opacity-90 mt-0.5">Theater an der Elbe &nbsp; - &nbsp; MJ Das Musical</div>
                                </div>
                                <div className="relative w-full md:max-w-xs">
                                    <input className="w-full bg-slate-800 p-3 pl-10 rounded-lg border border-slate-700 text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all placeholder-slate-500 font-brand" placeholder="Suche Channel oder Typ..." value={searchTerm} onChange={e => { setSearchTerm(e.target.value); if (e.target.value.trim() !== "") setShowAllForced(false); }} />
                                    <div className="absolute left-3 top-3.5 text-slate-500"><Icon name="Search" size={18} /></div>
                                    {searchTerm && <button onClick={() => setSearchTerm("")} className="absolute right-3 top-3.5 text-slate-500 hover:text-white"><Icon name="X" size={18} /></button>}
                                </div>
                            </div>
                            <div className="space-y-3 pt-2">
                                {activeFilter === "Alle" ? (
                                    <>
                                        <div className="flex justify-start">
                                            <button onClick={handleToggleAll} className={`min-w-[60px] px-4 py-1 rounded-lg text-xs font-medium transition-all border font-brand ${showAllForced && activeFilter === "Alle" && searchTerm === "" ? 'bg-blue-600 border-blue-500 text-white shadow-lg scale-105' : 'bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700 hover:border-slate-500'}`}>Alle</button>
                                        </div>
                                        <div className="flex flex-col gap-2">
                                            {filterRows.map((row, idx) => (
                                                <div key={idx} className="flex gap-2 overflow-x-auto scrollbar-hide py-0.5">
                                                    {row.map(item => <FilterBtn key={item.v} label={item.l} value={item.v} colorClass={item.c} />)}
                                                </div>
                                            ))}
                                            {otherPositions.length > 0 && (
                                                <div className="flex gap-2 overflow-x-auto scrollbar-hide border-t border-slate-800 pt-2 mt-1">
                                                    {otherPositions.map(p => <FilterBtn key={p} label={p} value={p} colorClass="text-slate-400" />)}
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    <div className="flex flex-col gap-2">
                                        <div className="flex justify-between items-center pb-2">
                                            <button onClick={() => toggleFilter("Alle")} className="flex items-center gap-1.5 pl-1 pr-3 py-1.5 text-xs font-medium text-slate-400 hover:text-white transition-colors">
                                                <Icon name="ArrowLeft" size={16} /> Zurück
                                            </button>
                                            {activeFilterData && (
                                                <FilterBtn label={activeFilterData.l} value={activeFilterData.v} colorClass={activeFilterData.c} />
                                            )}
                                        </div>
                                        
                                        {availableRows.length > 0 && (
                                            <>
                                                <div className="text-xs text-slate-400 font-normal px-1 pb-1">Wievielte Lampe von links bzw. unten ?</div>
                                                <div className="flex gap-2 overflow-x-auto scrollbar-hide py-1 border-t border-slate-800/50">
                                                    {availableRows.map(num => (
                                                        <button 
                                                            key={num}
                                                            onClick={() => toggleRowFilter(num)}
                                                            className={`w-8 h-8 rounded-full text-xs font-bold flex items-center justify-center transition-all border shrink-0 ${
                                                                activeRowFilter === num
                                                                ? 'bg-emerald-600 border-emerald-500 text-white shadow-lg scale-110'
                                                                : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:text-white'
                                                            }`}
                                                        >
                                                            {num}
                                                        </button>
                                                    ))}
                                                </div>
                                            </>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    <div className="p-4 md:p-8 max-w-7xl mx-auto">
                        {status && <div className="text-center py-4 text-xs text-yellow-600 mb-4 animate-pulse">{status}</div>}
                        {!isInteractionActive ? (
                            <div className="text-center p-20 text-slate-500 flex flex-col items-center gap-4 animate-in fade-in duration-700">
                                {/* Leerer Bereich, da Platzhalter entfernt wurde */}
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 grid-transition">
                                {filteredFixtures.map(fixture => {
                                    const parts = fixture.ADRESSE.split('/');
                                    const universe = parts[0];
                                    const rest = parts.length > 1 ? `/${parts.slice(1).join('.')}` : '';
                                    return (
                                        <div key={fixture.id} className="bg-slate-800/80 backdrop-blur-sm p-3.5 rounded-2xl border border-slate-700 shadow-md hover:shadow-xl hover:border-slate-500 transition-all duration-300 relative group flex flex-col justify-between min-h-[112px]">
                                            <div className="space-y-2 font-brand">
                                                <div className="flex items-center gap-3">
                                                    <span className="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm font-bold shadow-sm group-hover:bg-blue-500 transition-colors shrink-0">{fixture.CHANNEL}</span>
                                                    <h3 className="font-medium text-white text-base md:text-lg leading-tight truncate group-hover:text-blue-200 transition-colors">{fixture.TYP}</h3>
                                                </div>
                                                {fixture.ORT && <div className="flex justify-start"><div className="text-base font-bold text-emerald-400 truncate text-left max-w-full">{fixture.ORT}</div></div>}
                                            </div>
                                            <div className="mt-3 flex justify-between items-end gap-1">
                                                <div className="flex flex-col max-w-[65%]">
                                                    <div className="text-xs font-normal text-slate-300 truncate">{fixture.POSITION}</div>
                                                    {fixture.ROW && <div className="text-[9px] font-medium text-slate-500 uppercase tracking-tighter leading-tight mt-0.5 flex items-baseline">Fixture von links / unten:&nbsp;&nbsp;&nbsp;&nbsp;<span className="text-base font-bold text-slate-200">{fixture.ROW}</span></div>}
                                                </div>
                                                <div className="text-xs font-brand font-normal text-slate-300 tracking-tighter shrink-0 pb-1">DMX: <span className="font-bold">{universe}</span><span className="font-bold">{rest}</span></div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                        {isInteractionActive && filteredFixtures.length === 0 && (
                            <div className="text-center p-20 text-slate-500 flex flex-col items-center gap-4">
                                <div className="p-4 bg-slate-800 rounded-full"><Icon name="Search" size={40} className="text-slate-600" /></div>
                                <p className="text-lg">Keine Lampen für deine Auswahl gefunden.</p>
                                <button onClick={() => {setSearchTerm(""); setActiveFilter("Alle"); setShowAllForced(false);}} className="text-blue-500 hover:underline">Filter zurücksetzen</button>
                            </div>
                        )}
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 bg-slate-900/80 backdrop-blur-md border-t border-slate-800 p-4 text-center z-30 font-brand">
                        <div className="max-w-7xl mx-auto flex justify-between items-center text-[10px] text-slate-600 uppercase tracking-widest font-brand">
                            <span>{isInteractionActive ? filteredFixtures.length : 0} Geräte gefunden</span>
                            <span className="hidden sm:inline">HAYWIRE FINDER &nbsp;&nbsp; V &nbsp; 1 . 2</span>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    
    <script>
        if ('serviceWorker' in navigator) {
            const swContent = `
                self.addEventListener('install', (e) => self.skipWaiting());
                self.addEventListener('activate', (e) => e.waitUntil(self.clients.claim()));
                self.addEventListener('fetch', (e) => e.respondWith(fetch(e.request)));
            `;
            const blob = new Blob([swContent], {type: 'text/javascript'});
            const url = URL.createObjectURL(blob);
            navigator.serviceWorker.register(url)
                .catch((err) => console.log('SW fail', err));
        }
    </script>
</body>
</html>

