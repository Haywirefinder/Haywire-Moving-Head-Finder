<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haywire Moving Head Finder</title>
    
    <!-- Design & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #0f172a; }
        .font-brand { font-family: 'Tahoma', sans-serif; letter-spacing: normal; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icons = {
            Search: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            ),
            Edit2: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
            ),
            MapPin: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
            ),
            X: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            )
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const IconComponent = Icons[name];
            return IconComponent ? <IconComponent width={size} height={size} className={className} /> : null;
        };

        const MOCK_DATA = [
            { id: 1, CHANNEL: "101", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1.001" },
            { id: 2, CHANNEL: "102", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 2", ADRESSE: "1.036" }
        ];

        function App() {
            const [fixtures, setFixtures] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [activeFilter, setActiveFilter] = useState("Alle");
            const [status, setStatus] = useState("Lade Daten...");

            useEffect(() => {
                // Versuche zuerst die CSV zu laden (wichtig für GitHub Pages)
                if (window.Papa) {
                    window.Papa.parse("./fixtures.csv", { // ./ sorgt für relative Pfade
                        download: true,
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            if (results.data && results.data.length > 0) {
                                const parsed = results.data.map((row, i) => ({
                                    id: "csv-" + i,
                                    CHANNEL: row.CHANNEL || row.Channel || "---",
                                    TYP: row.TYP || row.Typ || "Unbekannt",
                                    POSITION: row.POSITION || row.Position || "Unbekannt",
                                    ORT: row.ORT || row.Ort || "",
                                    ADRESSE: row.ADRESSE || row.Adresse || "---" 
                                }));
                                setFixtures(parsed);
                                setStatus("");
                            } else {
                                setFixtures(MOCK_DATA);
                                setStatus("Demo-Modus (CSV leer)");
                            }
                        },
                        error: (err) => {
                            console.warn("CSV nicht gefunden, nutze Mock-Daten");
                            setFixtures(MOCK_DATA);
                            setStatus("Demo-Modus");
                        }
                    });
                }
            }, []);

            const filteredFixtures = useMemo(() => {
                return fixtures.filter(f => {
                    const search = searchTerm.toLowerCase();
                    const matchesSearch = f.CHANNEL.toLowerCase().includes(search) || f.TYP.toLowerCase().includes(search);
                    const matchesFilter = activeFilter === "Alle" || f.POSITION === activeFilter;
                    return matchesSearch && matchesFilter;
                });
            }, [fixtures, searchTerm, activeFilter]);

            return (
                <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-40">
                    <div className="sticky top-0 z-20 bg-slate-900/95 p-4 border-b border-slate-800 shadow-xl backdrop-blur-sm">
                        <div className="max-w-md mx-auto space-y-4">
                            <h1 className="text-xl font-bold text-white flex items-center gap-3 font-brand">
                                Haywire Moving Head Finder
                                {status && <span className="text-[10px] bg-amber-900 text-amber-200 px-2 py-0.5 rounded">{status}</span>}
                            </h1>
                            
                            <div className="relative">
                                <input 
                                    className="w-full bg-slate-800 p-3 pl-10 rounded-lg border border-slate-700 text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" 
                                    placeholder="Channel oder Typ suchen..." 
                                    value={searchTerm}
                                    onChange={e => setSearchTerm(e.target.value)} 
                                />
                                <div className="absolute left-3 top-3.5 text-slate-500">
                                    <Icon name="Search" size={18} />
                                </div>
                                {searchTerm && (
                                    <button onClick={() => setSearchTerm("")} className="absolute right-3 top-3.5 text-slate-500 hover:text-white">
                                        <Icon name="X" size={18} />
                                    </button>
                                )}
                            </div>

                            <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2">
                                {["Alle", "LX 1", "LX 2", "Portal", "Z-Brücke 1"].map(f => (
                                    <button 
                                        key={f} 
                                        onClick={() => setActiveFilter(f)}
                                        className={`px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap border ${activeFilter === f ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-800 border-slate-700 text-slate-400'}`}
                                    >
                                        {f}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="p-4 max-w-md mx-auto">
                        <div className="grid gap-3">
                            {filteredFixtures.map(fixture => (
                                <div key={fixture.id} className="bg-slate-800 p-4 rounded-xl border border-slate-700 relative">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <span className="bg-blue-600 text-white px-2 py-0.5 rounded text-sm font-bold font-mono">
                                                CH {fixture.CHANNEL}
                                            </span>
                                            <h3 className="font-bold text-white text-lg mt-1">{fixture.TYP}</h3>
                                            <div className="flex items-center gap-2 mt-2">
                                                <p className="text-xs text-slate-400 flex items-center gap-1 bg-slate-900/50 px-2 py-1 rounded">
                                                    <Icon name="MapPin" size={12} /> {fixture.POSITION}
                                                </p>
                                                {fixture.ORT && <p className="text-xs text-emerald-100 bg-emerald-900/60 px-2 py-1 rounded">{fixture.ORT}</p>}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="absolute bottom-4 right-4 text-[18px] font-mono">
                                        <span className="text-slate-500 text-xs mr-1 uppercase">DMX</span>
                                        <span className="text-blue-500 font-bold">{fixture.ADRESSE}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>