<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haywire Moving Head Finder</title>
    
    <!-- Design & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Google Fonts: Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        body { 
            background-color: #0f172a; 
            font-family: 'Roboto', sans-serif; 
        }
        
        .font-brand {
            font-family: 'Roboto', sans-serif;
            letter-spacing: normal;
        }

        .grid-transition {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icons = {
            MovingHead: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M4 21h16" /><path d="M18 21v-3a3 3 0 0 0-3-3H9a3 3 0 0 0-3 3v3" />
                    <rect x="8" y="3" width="8" height="10" rx="2" /><circle cx="12" cy="8" r="2" />
                </svg>
            ),
            Search: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            ),
            MapPin: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
            ),
            X: (props) => (
                <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            )
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const IconComponent = Icons[name];
            return IconComponent ? <IconComponent width={size} height={size} className={className} /> : null;
        };

        // --- MOCK DATEN (Fallback) ---
        const MOCK_DATA = [
            { id: 1, CHANNEL: "101", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 1", ADRESSE: "1.001" },
            { id: 2, CHANNEL: "102", TYP: "Viper Performance", POSITION: "LX 1", ORT: "Dimmerraum 2", ADRESSE: "1.036" },
            { id: 3, CHANNEL: "201", TYP: "Aura XB", POSITION: "Portal", ORT: "Dimmerraum 3", ADRESSE: "2.100" },
            { id: 4, CHANNEL: "202", TYP: "Aura XB", POSITION: "Sound Truss SR", ORT: "Dimmerraum 4", ADRESSE: "2.125" },
            { id: 5, CHANNEL: "301", TYP: "JDC 1", POSITION: "Z-Brücke 1", ORT: "Dimmerraum 1", ADRESSE: "3.001" },
            { id: 6, CHANNEL: "401", TYP: "MAC Ultra", POSITION: "LX 2", ORT: "Dimmerraum 1", ADRESSE: "1.201" },
            { id: 7, CHANNEL: "402", TYP: "MAC Ultra", POSITION: "LX 2", ORT: "Dimmerraum 1", ADRESSE: "1.250" },
        ];

        function App() {
            const [fixtures, setFixtures] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [activeFilter, setActiveFilter] = useState("Alle");
            const [status, setStatus] = useState("Lade...");

            const hardcodedValues = [
                "Z-Brücke 0", "Z-Brücke 1", "Z-Brücke 2",
                "Sound Truss SR", "Sound Truss SRC", "Sound Truss SLC", "Sound Truss SL",
                "Prosc Boom SR", "Near Box Boom SR", "Advanced Truss SR", "Advanced Truss SL", "Near Box Boom SL", "Prosc Boom SL", "DS Trough", "Portal",
                "LX 1", "LX 2", "LX 3", "LX 4", "LX 5",
                "Leiter 1 SR", "Leiter 2 SR", "Leiter 3 SR", "Leiter 4 SR", "Leiter 1 SL", "Leiter 2 SL", "Leiter 3 SL", "Leiter 4 SL",
                "Boom 1 SR", "Boom 2 SR", "Boom 3 SR", "Boom 4 SR", "Boom 1 SL", "Boom 2 SL", "Boom 3 SL", "Boom 4 SL"
            ];

            useEffect(() => {
                const loadData = async () => {
                    try {
                        const response = await fetch("fixtures.csv").catch(() => null);
                        if (response && response.ok) {
                            const csvText = await response.text();
                            window.Papa.parse(csvText, {
                                header: true,
                                skipEmptyLines: true,
                                complete: (results) => {
                                    if (results.data && results.data.length > 0) {
                                        const parsed = results.data.map((row, i) => ({
                                            id: Date.now() + i,
                                            CHANNEL: row.CHANNEL || row.Channel || "---",
                                            TYP: row.TYP || row.Typ || "Unbekannt",
                                            POSITION: row.POSITION || row.Position || "Unbekannt",
                                            ORT: row.ORT || row.Ort || "",
                                            ADRESSE: row.ADRESSE || row.Adresse || "---" 
                                        }));
                                        setFixtures(parsed);
                                        setStatus("");
                                    } else {
                                        setFixtures(MOCK_DATA);
                                        setStatus("Demo-Modus");
                                    }
                                }
                            });
                        } else {
                            throw new Error("CSV nicht erreichbar");
                        }
                    } catch (e) {
                        setFixtures(MOCK_DATA);
                        setStatus("Demo-Modus");
                    }
                };
                loadData();
            }, []);

            const filteredFixtures = useMemo(() => {
                return fixtures.filter(f => {
                    const search = searchTerm.toLowerCase();
                    const matchesSearch = f.CHANNEL.toLowerCase().includes(search) || f.TYP.toLowerCase().includes(search);
                    const matchesFilter = activeFilter === "Alle" || f.POSITION === activeFilter;
                    return matchesSearch && matchesFilter;
                });
            }, [fixtures, searchTerm, activeFilter]);

            const otherPositions = useMemo(() => {
                const allPos = new Set(fixtures.map(f => f.POSITION));
                return Array.from(allPos).filter(p => p && p !== "Unbekannt" && !hardcodedValues.includes(p)).sort();
            }, [fixtures]);

            const toggleFilter = (val) => setActiveFilter(activeFilter === val ? "Alle" : val);

            const FilterBtn = ({ label, value }) => (
                <button 
                    onClick={() => toggleFilter(value)} 
                    className={`px-3 py-1.5 rounded-lg text-xs font-normal whitespace-nowrap border transition-all font-brand ${
                        activeFilter === value 
                        ? 'bg-blue-600 border-blue-500 text-white shadow-lg scale-105' 
                        : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:border-slate-500'
                    }`}
                >
                    {label}
                </button>
            );

            return (
                <div className="min-h-screen bg-slate-900 text-slate-200 font-brand pb-40">
                    <div className="sticky top-0 z-20 bg-slate-900/95 border-b border-slate-800 shadow-xl backdrop-blur-md px-4 py-4 md:py-6">
                        <div className="max-w-7xl mx-auto space-y-4">
                            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <h1 className="text-xl md:text-2xl font-normal text-white font-brand truncate">
                                    Haywire moving head finder
                                </h1>
                                
                                <div className="relative w-full md:max-w-xs">
                                    <input 
                                        className="w-full bg-slate-800 p-3 pl-10 rounded-lg border border-slate-700 text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all placeholder-slate-500 font-brand" 
                                        placeholder="Suche Channel oder Typ..." 
                                        value={searchTerm} 
                                        onChange={e => setSearchTerm(e.target.value)} 
                                    />
                                    <div className="absolute left-3 top-3.5 text-slate-500"><Icon name="Search" size={18} /></div>
                                    {searchTerm && <button onClick={() => setSearchTerm("")} className="absolute right-3 top-3.5 text-slate-500 hover:text-white"><Icon name="X" size={18} /></button>}
                                </div>
                            </div>

                            <div className="space-y-3 pt-2">
                                <div className="flex flex-col gap-2">
                                    {[
                                        ["Z-Brücke 0", "Z-Brücke 1", "Z-Brücke 2"],
                                        [{l:"ST SR",v:"Sound Truss SR"},{l:"ST SRC",v:"Sound Truss SRC"},{l:"ST SLC",v:"Sound Truss SLC"},{l:"ST SL",v:"Sound Truss SL"}],
                                        [{l:"PB SR",v:"Prosc Boom SR"},{l:"NBB SR",v:"Near Box Boom SR"},{l:"AT SR",v:"Advanced Truss SR"},{l:"AT SL",v:"Advanced Truss SL"},{l:"NBB SL",v:"Near Box Boom SL"},{l:"PB SL",v:"Prosc Boom SL"},{l:"DS Trough",v:"DS Trough"},{l:"Portal",v:"Portal"}],
                                        ["LX 1", "LX 2", "LX 3", "LX 4", "LX 5"],
                                        [{l:"L1SR",v:"Leiter 1 SR"},{l:"L2SR",v:"Leiter 2 SR"},{l:"L3SR",v:"Leiter 3 SR"},{l:"L4SR",v:"Leiter 4 SR"},{l:"L1SL",v:"Leiter 1 SL"},{l:"Leiter 2 SL",v:"Leiter 2 SL"},{l:"L3SL",v:"Leiter 3 SL"},{l:"L4SL",v:"Leiter 4 SL"}],
                                        [{l:"B1SR",v:"Boom 1 SR"},{l:"B2SR",v:"Boom 2 SR"},{l:"B3SR",v:"Boom 3 SR"},{l:"B4SR",v:"Boom 4 SR"},{l:"B1SL",v:"Boom 1 SL"},{l:"B2SL",v:"Boom 2 SL"},{l:"B3SL",v:"Boom 3 SL"},{l:"B4SL",v:"Boom 4 SL"}]
                                    ].map((row, idx) => (
                                        <div key={idx} className="flex gap-2 overflow-x-auto scrollbar-hide py-0.5">
                                            {row.map(item => {
                                                const label = typeof item === 'string' ? item : item.l;
                                                const value = typeof item === 'string' ? item : item.v;
                                                return <FilterBtn key={value} label={label} value={value} />;
                                            })}
                                        </div>
                                    ))}
                                    
                                    {otherPositions.length > 0 && (
                                        <div className="flex gap-2 overflow-x-auto scrollbar-hide border-t border-slate-800 pt-2 mt-1">
                                            {otherPositions.map(p => <FilterBtn key={p} label={p} value={p} />)}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="p-4 md:p-8 max-w-7xl mx-auto">
                        {status && <div className="text-center py-4 text-xs text-yellow-600 mb-4 animate-pulse">{status}</div>}
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 grid-transition">
                            {filteredFixtures.map(fixture => {
                                const parts = fixture.ADRESSE.split('.');
                                const universe = parts[0];
                                const rest = parts.length > 1 ? `.${parts.slice(1).join('.')}` : '';

                                return (
                                    <div key={fixture.id} className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-md hover:shadow-xl hover:border-slate-500 transition-all duration-300 relative group flex flex-col justify-between min-h-[150px]">
                                        <div className="space-y-4 font-brand">
                                            <div className="flex items-center gap-3">
                                                <span className="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm font-bold shadow-sm group-hover:bg-blue-500 transition-colors shrink-0">
                                                    {fixture.CHANNEL}
                                                </span>
                                                <h3 className="font-medium text-white text-base md:text-lg leading-tight truncate group-hover:text-blue-200 transition-colors">
                                                    {fixture.TYP}
                                                </h3>
                                            </div>
                                            
                                            <div className="flex flex-wrap items-center gap-2">
                                                {/* Positionsangabe auf font-normal eingestellt */}
                                                <p className="text-xs font-normal text-slate-300 flex items-center gap-1.5 bg-slate-900/80 px-2.5 py-1.5 rounded-full border border-slate-700/50">
                                                    <Icon name="MapPin" size={12} className="text-slate-500" /> 
                                                    {fixture.POSITION}
                                                </p>
                                                {fixture.ORT && (
                                                    /* Ortsangabe auf font-normal eingestellt */
                                                    <p className="text-xs font-normal text-emerald-100 bg-emerald-900/40 px-2.5 py-1.5 rounded-full border border-emerald-800/30">
                                                        {fixture.ORT}
                                                    </p>
                                                )}
                                            </div>
                                        </div>
                                        
                                        <div className="mt-6 flex justify-end">
                                            {/* DMX Anzeige auf font-normal eingestellt */}
                                            <div className="text-xs font-brand font-normal text-slate-500 tracking-tighter bg-slate-900/40 px-3 py-1 rounded-lg">
                                                DMX: <span className="text-blue-600 font-bold">{universe}</span><span className="text-slate-400 font-bold">{rest}</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        
                        {filteredFixtures.length === 0 && (
                            <div className="text-center p-20 text-slate-500 flex flex-col items-center gap-4">
                                <div className="p-4 bg-slate-800 rounded-full">
                                    <Icon name="Search" size={40} className="text-slate-600" />
                                </div>
                                <p className="text-lg">Keine Lampen für deine Auswahl gefunden.</p>
                                <button onClick={() => {setSearchTerm(""); setActiveFilter("Alle");}} className="text-blue-500 hover:underline">Filter zurücksetzen</button>
                            </div>
                        )}
                    </div>

                    <div className="fixed bottom-0 left-0 right-0 bg-slate-900/80 backdrop-blur-md border-t border-slate-800 p-4 text-center z-30 font-brand">
                        <div className="max-w-7xl mx-auto flex justify-between items-center text-[10px] text-slate-600 uppercase tracking-widest">
                            <span>{filteredFixtures.length} Geräte gefunden</span>
                            <span className="hidden sm:inline">Haywire Production Finder v2.0</span>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
